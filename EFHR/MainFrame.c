/*
2021 Yonsei Computer Programming Project (prof. Hyo Sang Lim)
[Game - Hard Rain Impact]

All code written by Sungha Choi

All rights reserved...
*/

#include <stdio.h>
#include <conio.h>
#include <string.h>
#include <Windows.h>

#define PowerHeight 4
#define FactoryHeight 3
#define ResidenceHeight 2

#define DialogLength 63

enum { False, True };

enum { 

	Black, 
	D_Blue, 
	D_Green, 
	D_Cyan, 
	D_Red, 
	D_Violet, 
	D_Yellow, 
	Gray, 
	D_Gray, 
	Blue, 
	Green, 
	Cyan, 
	Red, 
	Violet, 
	Yellow, 
	White 
};

enum BuildingType
{

	Blank,
	Power,
	Factory,
	Residence
};

enum PhaseState {

	BuildingPhase,
	EnterProductionPhase,
	ProductionPhase
};

enum ErrorCode {

	Canceled = -4,
	Confirm,
	NotingLeft,
	AlreadyOccupied
};

typedef struct {

	char UserName[11];
	char CityName[11];
}User;

typedef struct {

	short PowerLeft;
	short FactoryLeft;
	short ResidenceLeft;
}Buildings;

typedef struct {

	int EnergyState;
	int TechnologyState;
	int CapitalState;
}Resources;

typedef struct {

	User U;

	short UserPosition;

	Buildings B;

	short OccupyState[12];
	short Health[12];

	Resources R;
}City;

void SplashScreen(void);
void CharBlink(char toBlink, short show, short color);

void GameSetup(void);
 
void StoryDescriptor(void);

void PAC(void);
void CurPos(short x, short y);
void CursorView(short show);
void K_Putchar(char toPrint[], short index);

void TypeAnimation(char toPrint[]);
void DialogDisplay(char toPrint[]);

void UserInfo(char UserName[]);
void CityInfo(char CityName[]);

void GameInitialize(short GamePhase);
void BuildingHeight(void);
void AvailableBuilding(int AvailPower, int AvailFactory, int AvailResidence);
void ResourceDisplayer(int EnergyState, int TechnologyState, int CapitalState, short ResourceType);
void SystemMessage(char CityName[], short MessageType);

void UserPrint(short UserPosition);

short BuildingConfirm(short BuildingType);

void BuildingBuilder(short OccupyState[]);
void MakePower(short UserPosition, short Health);
void MakeFactory(short UserPosition, short Health);
void MakeResidence(short UserPosition, short Health);

int main(void) {

	City C = { .UserPosition = 0,
		.B.PowerLeft = 4, .B.FactoryLeft = 4, .B.ResidenceLeft = 4,
		.OccupyState = { Blank }, 
		.R.EnergyState = 0, .R.TechnologyState = 0, .R.CapitalState = 0 };
	
	short GameState = BuildingPhase;
	short IsBuildingError;
	char UserInput;

	system("title Hard Rain Impact v1.0");

	SplashScreen();
	
	GameSetup();

	UserInfo(C.U.UserName);
	CityInfo(C.U.CityName);

	GameInitialize(GameState);

	AvailableBuilding(C.B.PowerLeft, C.B.FactoryLeft, C.B.ResidenceLeft);
	UserPrint(C.UserPosition);
	SystemMessage(C.U.CityName, GameState);

	while (True) {

		UserInput = _getch();

		if (UserInput == 'x') break;

		else if (UserInput == 'a') --C.UserPosition;
		else if (UserInput == 'd') ++C.UserPosition;

		if (C.UserPosition < 0) {

			C.UserPosition = 0;
			continue;
		}
		if (C.UserPosition > 11) {

			C.UserPosition = 11;
			continue;
		}

		UserPrint(C.UserPosition);
		SystemMessage(C.U.CityName, GameState);

		if (!(UserInput == 'a' || UserInput == 'd') && GameState == BuildingPhase) {

			IsBuildingError = False;

			if (UserInput == 'e') {

				if (C.OccupyState[C.UserPosition]) {

					SystemMessage(C.U.CityName, AlreadyOccupied);
					IsBuildingError = True;
				}
				else if (!C.B.PowerLeft) {

					SystemMessage(C.U.CityName, NotingLeft);
					IsBuildingError = True;
				}

				if (!IsBuildingError) {

					if (BuildingConfirm(Power)) {

						C.OccupyState[C.UserPosition] = Power;
						C.Health[C.UserPosition] = PowerHeight;
						--C.B.PowerLeft;
					}
					else GameState = Canceled;
				}
			}
			else if (UserInput == 't') {

				if (C.OccupyState[C.UserPosition]) {

					SystemMessage(C.U.CityName, AlreadyOccupied);
					IsBuildingError = True;
				}
				else if (!C.B.FactoryLeft) {

					SystemMessage(C.U.CityName, NotingLeft);
					IsBuildingError = True;
				}

				if (!IsBuildingError) {

					if (BuildingConfirm(Factory)) {

						C.OccupyState[C.UserPosition] = Factory;
						C.Health[C.UserPosition] = FactoryHeight;
						--C.B.FactoryLeft;
					}
					else GameState = Canceled;
				}
			}
			else if (UserInput == 'm') {

				if (C.OccupyState[C.UserPosition]) {

					SystemMessage(C.U.CityName, AlreadyOccupied);
					IsBuildingError = True;
				}
				else if (!C.B.ResidenceLeft) {

					SystemMessage(C.U.CityName, NotingLeft);
					IsBuildingError = True;
				}

				if (!IsBuildingError) {

					if (BuildingConfirm(Residence)) {

						C.OccupyState[C.UserPosition] = Residence;
						C.Health[C.UserPosition] = ResidenceHeight;
						--C.B.ResidenceLeft;
					}
					else GameState = Canceled;
				}
			}

			AvailableBuilding(C.B.PowerLeft, C.B.FactoryLeft, C.B.ResidenceLeft);

			if (IsBuildingError == False) SystemMessage(C.U.CityName, GameState);
			if (GameState == Canceled) GameState = BuildingPhase;

			BuildingBuilder(C.OccupyState);

			if (!C.B.PowerLeft && !C.B.FactoryLeft && !C.B.ResidenceLeft) {

				SystemMessage(C.U.CityName, EnterProductionPhase);
				GameInitialize(ProductionPhase);
				ResourceDisplayer(C.R.EnergyState, C.R.TechnologyState, C.R.CapitalState, C.OccupyState[C.UserPosition]);
				GameState = ProductionPhase;
			}
		}
		else if (GameState == ProductionPhase) {

			if (C.OccupyState[C.UserPosition] == Power) ++C.R.EnergyState;
			else if (C.OccupyState[C.UserPosition] == Factory) ++C.R.TechnologyState;
			else if (C.OccupyState[C.UserPosition] == Residence) ++C.R.CapitalState;
			ResourceDisplayer(C.R.EnergyState, C.R.TechnologyState, C.R.CapitalState, C.OccupyState[C.UserPosition]);
		}
	}

	DialogDisplay("게임을 종료합니다... 나중에 다시 뵙겠습니다 사령관님.");

	return 0;
}

void SplashScreen(void) {

	system("mode con:cols=96 lines=24");

	CursorView(0);

	SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), Red);

	putchar('\n');
	puts(":::    :::     :::     :::::::::  :::::::::   :::::::::      :::     ::::::::::: ::::    :::");
	puts(":+:    :+:   :+: :+:   :+:    :+: :+:    :+:  :+:    :+:   :+: :+:       :+:     :+:+:   :+:");
	puts("+:+    +:+  +:+   +:+  +:+    +:+ +:+    +:+  +:+    +:+  +:+   +:+      +:+     :+:+:+  +:+");
	puts("+#++:++#++ +#++:++#++: +#++:++#:  +#+    +:+  +#++:++#:  +#++:++#++:     +#+     +#+ +:+ +#+");
	puts("+#+    +#+ +#+     +#+ +#+    +#+ +#+    +#+  +#+    +#+ +#+     +#+     +#+     +#+  +#+#+#");
	puts("#+#    #+# #+#     #+# #+#    #+# #+#    #+#  #+#    #+# #+#     #+#     #+#     #+#   #+#+#");
	puts("###    ### ###     ### ###    ### #########   ###    ### ###     ### ########### ###    ####");
	putchar('\n');
	puts("          ::::::::::: ::::    ::::  :::::::::      :::      ::::::::  :::::::::::");
	puts("              :+:     +:+:+: :+:+:+ :+:    :+:   :+: :+:   :+:    :+:     :+:    ");
	puts("              +:+     +:+ +:+:+ +:+ +:+    +:+  +:+   +:+  +:+            +:+    ");
	puts("              +#+     +#+  +:+  +#+ +#++:++#+  +#++:++#++: +#+            +#+    ");
	puts("              +#+     +#+       +#+ +#+        +#+     +#+ +#+            +#+    ");
	puts("              #+#     #+#       #+# #+#        #+#     #+# #+#    #+#     #+#    ");
	puts("          ########### ###       ### ###        ###     ###  ########      ###    ");

	for (int i = 0;; ++i) {

		CurPos(2, 10);
		CharBlink('+', i % 2, Red);

		CurPos(86, 12);
		CharBlink('+', i % 2, Red);

		CurPos(4, 14);
		CharBlink('*', i % 2, Red);

		CurPos(84, 14);
		CharBlink('*', i % 2, Red);

		if (i % 2) SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), Black);
		else SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), White);

		CurPos(30, 17);
		puts("▶ Press Any Key to Start ◀");

		if (_kbhit())break;

		Sleep(500);
	}

	SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), White);

	char Dummy = _getch();
}

void CharBlink(char toBlink, short show, short color) {

	SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), color);
	if (show) putchar(toBlink);
	else putchar(' ');
	SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), White);
}

void GameSetup(void) {

	char UserInput;

	system("cls");

	puts("┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓");
	puts("┃ 권장 화면 비율을 사용하시겠습니까? (매우 권장!) [Y/N]┃");
	puts("┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛");

	UserInput = _getch();

	if (UserInput == 'Y' || UserInput == 'y') system("mode con:cols=67 lines=24");

	system("cls");

	puts("┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓");
	puts("┃ 스토리를 시청하시겠습니까? [Y/N]┃");
	puts("┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛");

	UserInput = _getch();

	if (UserInput == 'Y' || UserInput == 'y') StoryDescriptor();
}

void StoryDescriptor(void) {

	system("cls");

	DialogDisplay("SYSTEM : Incoming Message...");
	DialogDisplay("SYSTEM : 긴급 메시지입니다.");
	DialogDisplay("정체불명의 원인 에이전트(Agent)로 인해 달이 7조각으로 쪼개졌다네.");
	DialogDisplay("7조각의 달은 각자의 중력으로 한동안 궤도를 유지하였으나,");
	DialogDisplay("곧 서로 충돌하여 더 작은 조각으로 나뉘어지기 시작했네.");
	DialogDisplay("두브 박사의 시뮬레이션에 의하면 이러한 충돌 현상은 기하급수적으로 가속될 것이며...");
	DialogDisplay("곧 전 지구 궤도가 달의 암석 조각으로 뒤덮이는 화이트 스카이(White Sky) 현상이 발생할 것이라 한다네.");
	DialogDisplay("시뮬레이션 결과에서 더욱 암울한 것은 화이트 스카이 발생 후 몇 년 이내에...");
	DialogDisplay("수 조 개에 달하는 궤도 상의 달 암석 조각들이 지구 중력에 이끌려 동시다발적으로 지구로 쏟아져 내리는...");
	DialogDisplay("하드레인(Hard Rain) 현상이 시작되어 약 5,000년 간 지속된다는 것이네. ");
	DialogDisplay("우리 인류는 종말을 목전에 두고 있네...");
	DialogDisplay("자네는 이러한 절망적인 상황에서 도시를 건설하고 인류의 마지막 희망인 우주선...");
	DialogDisplay("클라우드아크(Cloud Ark)를 건조하여 발사할 때 까지 살아남는 미션을 지휘할 사령관으로 임명되었네.");
	DialogDisplay("인류의 미래가 그대의 어깨에 달려있네...");
	DialogDisplay("사령관...");
	DialogDisplay("건투를 비네.");
	DialogDisplay("SYSTEM : 통신이 종료되었습니다.");
}

void PAC(void) {

	for (int i = 0;; ++i) {

		if (i % 2) SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), Black);
		else SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), White);

		CurPos(22, 20);
		puts("▶ Press Any Key ◀");

		if (_kbhit())break;

		Sleep(500);
	}

	SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), White);

	char Dummy = _getch();
}

void CurPos(short x, short y) {

	COORD Pos = { x, y };
	SetConsoleCursorPosition(GetStdHandle(STD_OUTPUT_HANDLE), Pos);
}

void CursorView(short show) {

	HANDLE hConsole;
	CONSOLE_CURSOR_INFO ConsoleCursor;

	hConsole = GetStdHandle(STD_OUTPUT_HANDLE);

	ConsoleCursor.bVisible = show;
	ConsoleCursor.dwSize = 1;

	SetConsoleCursorInfo(hConsole, &ConsoleCursor);
}

void K_Putchar(char toPrint[], short index) {

	putchar(toPrint[index]);
	if (toPrint[index + 1]) putchar(toPrint[index + 1]);
}

void TypeAnimation(char toPrint[]) {

	SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), Cyan);

	for (short i = 0; toPrint[i]; i += 2) {

		if (toPrint[i] != ' ') {

			K_Putchar(toPrint, i);
			Sleep(25);
		}
		else {

			putchar(' ');
			--i;
		}

		if (!toPrint[i + 1]) break;
	}

	SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), White);
}

void DialogDisplay(char toPrint[]) {

	char LineCutA[DialogLength + 1];
	char LineCutB[DialogLength + 1];

	short Line = 1;
	short StrLen = (short)strlen(toPrint);

	if (StrLen > DialogLength) {

		strncpy_s(LineCutA, sizeof(LineCutA), toPrint, DialogLength);

		for (short i = 0; i < StrLen - DialogLength; ++i) LineCutB[i] = toPrint[i + DialogLength];

		LineCutB[StrLen - DialogLength] = 0;

		++Line;
	}

	system("cls");

	CurPos(0, 0);

	printf("┏");

	if (Line < 2) {

		for (short i = 0; i < DialogLength; ++i) printf("━");

		printf("━┓\n┃\n┗");

		for (short i = 0; i < DialogLength; ++i) printf("━");

		printf("━┛");

		CurPos(DialogLength + 2, 1);
		printf("┃");

		CurPos(2, 1);
		TypeAnimation(toPrint);
	}
	else {

		for (short i = 0; i < DialogLength; ++i) printf("━");

		printf("━┓\n┃\n┃\n┗");

		for (short i = 0; i < DialogLength; ++i) printf("━");

		printf("━┛");

		CurPos(DialogLength + 2, 1);
		printf("┃");
		CurPos(DialogLength + 2, 2);
		printf("┃");

		CurPos(2, 1);
		TypeAnimation(LineCutA);

		CurPos(2, 2);
		TypeAnimation(LineCutB);
	}
	CurPos(0, 2);

	PAC();
}

void UserInfo(char UserName[]) {

	CONSOLE_SCREEN_BUFFER_INFO curInfo;

	char CharBuffer;
	char UserInput;
	char StringBuffer[11] = { 0 };

	int Index = 0;

	system("cls");

	CursorView(1);

	printf("┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━┓\n");
	printf("┃ 당신의 이름은? (최대 영문 10자, 공백 불가)┃           ┃\n");
	printf("┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┻━━━━━━━━━━━┛\n");

	CurPos(46, 1);

	while (1) {

		GetConsoleScreenBufferInfo(GetStdHandle(STD_OUTPUT_HANDLE), &curInfo);

		CursorView(0);
		CurPos(1, 3);
		printf("남은 글자 수 : %-24d", 56 - curInfo.dwCursorPosition.X);

		CurPos(curInfo.dwCursorPosition.X, 1);
		CursorView(1);

		CharBuffer = _getche();
		if (CharBuffer > 32) StringBuffer[Index] = CharBuffer;
		++Index;

		if (curInfo.dwCursorPosition.X == 55 || CharBuffer == 13) {

			if (StringBuffer[0] == 0) {

				CurPos(1, 3);
				printf("SYSTEM : 이름은 반드시 입력해야 합니다.");

				CurPos(curInfo.dwCursorPosition.X, 1);
				Index = 0;

				Sleep(500);
			}
			else {
			
				strcpy_s(UserName, 11, StringBuffer);
				break;
			}
		}

		else if (CharBuffer == 8 && curInfo.dwCursorPosition.X > 46) {

			Index -= 2;
			if (Index > -1) StringBuffer[Index] = 0;
			putchar(' ');
			CurPos(curInfo.dwCursorPosition.X - 1, 1);
		}
		else if (CharBuffer == 8 && curInfo.dwCursorPosition.X == 46) {

			Index = 0;
			CurPos(curInfo.dwCursorPosition.X, 1);
		}

		Sleep(50);
	}

	CursorView(0);

	CurPos(1, 3);

	printf("SYSTEM : %s 사령관님, 입력하신 이름이 맞습니까? [Y/N]", UserName);

	UserInput = _getch();

	if (UserInput == 'Y' || UserInput == 'y') return;

	UserInfo(UserName);
}

void CityInfo(char CityName[]) {

	CONSOLE_SCREEN_BUFFER_INFO curInfo;

	char Dummy;
	char UserInput;
	char StringBuffer[11] = { 0 };

	int Index = 0;

	system("cls");

	CursorView(1);

	printf("┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━┓\n");
	printf("┃ 방어할 도시의 이름은? (최대 영문 10자, 공백 불가)┃           ┃\n");
	printf("┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┻━━━━━━━━━━━┛\n");

	CurPos(53, 1);

	while (1) {

		GetConsoleScreenBufferInfo(GetStdHandle(STD_OUTPUT_HANDLE), &curInfo);

		CursorView(0);
		CurPos(1, 3);
		printf("남은 글자 수 : %-29d", 63 - curInfo.dwCursorPosition.X);

		CurPos(curInfo.dwCursorPosition.X, 1);
		CursorView(1);

		Dummy = _getche();
		if (Dummy > 32) StringBuffer[Index] = Dummy;
		++Index;

		if (curInfo.dwCursorPosition.X == 62 || Dummy == 13) {

			if (StringBuffer[0] == 0) {

				CurPos(1, 3);
				printf("SYSTEM : 도시 이름은 반드시 입력해야 합니다.");

				CurPos(curInfo.dwCursorPosition.X, 1);
				Index = 0;

				Sleep(500);
			}
			else {

				strcpy_s(CityName, 11, StringBuffer);
				break;
			}
		}

		else if (Dummy == 8 && curInfo.dwCursorPosition.X > 53) {

			Index -= 2;
			if(Index > -1) StringBuffer[Index] = 0;
			putchar(' ');
			CurPos(curInfo.dwCursorPosition.X - 1, 1);
		}
		else if (Dummy == 8 && curInfo.dwCursorPosition.X == 53) {

			Index = 0;
			CurPos(curInfo.dwCursorPosition.X, 1);
		}

		Sleep(50);
	}

	CursorView(0);

	CurPos(1, 3);

	printf("SYSTEM : 사령관님, 입력하신 도시의 이름이 %s 입니까? [Y/N]", CityName);

	UserInput = _getch();

	if (UserInput == 'Y' || UserInput == 'y') return;

	CityInfo(CityName);
}

void GameInitialize(short GamePhase) {

	if (GamePhase == BuildingPhase) {

		system("cls");

		CursorView(0);

		CurPos(1, 0);
		printf("┏━━━━━━━┳━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━┓"); CurPos(1, 1);
		printf("┃ "); SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), Yellow);
		printf("발전소"); SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), White);
		printf("┃ 높이 0┃ 건설 가능 수 : 0┃ 건설 : e┃"); CurPos(1, 2);
		printf("┣━━━━━━━╋━━━━━━━╋━━━━━━━━━━━━━━━━━╋━━━━━━━━━┫"); CurPos(1, 3);
		printf("┃ "); SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), Red);
		printf("공  장"); SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), White);
		printf("┃ 높이 0┃ 건설 가능 수 : 0┃ 건설 : t┃"); CurPos(1, 4);
		printf("┣━━━━━━━╋━━━━━━━╋━━━━━━━━━━━━━━━━━╋━━━━━━━━━┫"); CurPos(1, 5);
		printf("┃ "); SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), Green);
		printf("주거지"); SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), White);
		printf("┃ 높이 0┃ 건설 가능 수 : 0┃ 건설 : m┃"); CurPos(1, 6);
		printf("┗━━━━━━━┻━━━━━━━┻━━━━━━━━━━━━━━━━━┻━━━━━━━━━┛"); CurPos(1, 7);
		printf("┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓"); CurPos(1, 8);
		printf("┃ SYSTEM :                                  ┃"); CurPos(1, 9);
		printf("┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛"); CurPos(1, 10);
		printf("┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓"); CurPos(1, 11);
		printf("┃                                           ┃"); CurPos(1, 12);
		printf("┃         <신입 사령관을 위한 메모>         ┃"); CurPos(1, 13);
		printf("┃                                           ┃"); CurPos(1, 14);
		printf("┃           취임을 환영하네 사령관          ┃"); CurPos(1, 15);
		printf("┃  위 메뉴를 참고하여 도시 건설을 진행하게  ┃"); CurPos(1, 16);
		printf("┃     각 건물은 고유의 자원을 생산한다네    ┃"); CurPos(1, 17);
		printf("┃      그러니 현명하게 건설을 진행하게      ┃"); CurPos(1, 18);
		printf("┃                                           ┃"); CurPos(1, 19);
		printf("┃                                           ┃"); CurPos(1, 20);
		printf("┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛"); CurPos(1, 21);
		printf("┏━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┓"); CurPos(1, 22);
		printf("┃ 이  동┃ 왼쪽 : a 오른쪽 : d┃ 게임 종료 : x┃"); CurPos(1, 23);
		printf("┗━━━━━━━┻━━━━━━━━━━━━━━━━━━━━┻━━━━━━━━━━━━━━┛");

		BuildingHeight();

		CurPos(50, 0);
		printf("┏━━━━━━━━━━━━━┓"); CurPos(50, 1);
		for (short i = 2; i < 22; ++i) {
			printf("┃             ┃"); CurPos(50, i);
		}
		printf("┣━━━━━━━━━━━━━┫"); CurPos(50, 22);
		printf("┃             ┃"); CurPos(50, 23);
		printf("┗━━━━━━━━━━━━━┛");
	}
	else if (GamePhase == ProductionPhase) {

		CurPos(1, 0);
		printf("┏━━━━━━━┳━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━┓"); CurPos(1, 1);
		printf("┃ "); SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), Yellow);
		printf("발전소"); SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), White);
		printf("┃ "); SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), D_Yellow);
		printf("에너지"); SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), White);
		printf("┃ 1234567890123456┃ 오 류 임┃"); CurPos(1, 2);
		printf("┣━━━━━━━╋━━━━━━━╋━━━━━━━━━━━━━━━━━╋━━━━━━━━━┫"); CurPos(1, 3);
		printf("┃ "); SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), Red);
		printf("공  장"); SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), White);
		printf("┃ "); SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), D_Red);
		printf("기  술"); SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), White);
		printf("┃ 1234567890123456┃ 오 류 임┃"); CurPos(1, 4);
		printf("┣━━━━━━━╋━━━━━━━╋━━━━━━━━━━━━━━━━━╋━━━━━━━━━┫"); CurPos(1, 5);
		printf("┃ "); SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), Green);
		printf("주거지"); SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), White);
		printf("┃ "); SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), D_Green);
		printf("자  본"); SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), White);
		printf("┃ 1234567890123456┃ 오 류 임┃"); CurPos(1, 6);
		printf("┗━━━━━━━┻━━━━━━━┻━━━━━━━━━━━━━━━━━┻━━━━━━━━━┛"); CurPos(1, 10);
		printf("┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓"); CurPos(1, 11);
		printf("┃                                           ┃"); CurPos(1, 12);
		printf("┃         <신입 사령관을 위한 메모>         ┃"); CurPos(1, 13);
		printf("┃                                           ┃"); CurPos(1, 14);
		printf("┃             도시를 잘 건설했군            ┃"); CurPos(1, 15);
		printf("┃           좌우로 자네가 움직이면          ┃"); CurPos(1, 16);
		printf("┃       자네가 도착한 구역의 건물로부터     ┃"); CurPos(1, 17);
		printf("┃         고유한 자원을 획득할 수 있네      ┃"); CurPos(1, 18);
		printf("┃      필요한 자원을 효율적으로 모아보게    ┃"); CurPos(1, 19);
		printf("┃                                           ┃"); CurPos(1, 20);
		printf("┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛"); CurPos(0, 23);
	}
}

void BuildingHeight(void) {

	CurPos(16, 1);
	printf("%d", PowerHeight); CurPos(16, 3);
	printf("%d", FactoryHeight); CurPos(16, 5);
	printf("%d", ResidenceHeight);
}

void AvailableBuilding(int AvailPower, int AvailFactory, int AvailResidence) {

	CurPos(34, 1);

	if (!AvailPower) SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), Red);
	printf("%d", AvailPower); CurPos(34, 3);
	if (!AvailPower) SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), White);

	if (!AvailFactory) SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), Red);
	printf("%d", AvailFactory); CurPos(34, 5);
	if (!AvailFactory) SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), White);

	if (!AvailResidence) SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), Red);
	printf("%d", AvailResidence); CurPos(0, 23);
	if (!AvailResidence) SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), White);
}

void ResourceDisplayer(int EnergyState, int TechnologyState, int CapitalState, short ResourceType) {

	CurPos(19, 1);
	printf("%-16d", EnergyState); CurPos(37, 1);

	if (ResourceType == Power) {

		SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), Green);
		printf("생 산 중");
	}
	else {

		SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), Red);
		printf("대 기 중"); 
	}

	SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), White);

	CurPos(19, 3);
	printf("%-16d", TechnologyState); CurPos(37, 3);

	if (ResourceType == Factory) {

		SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), Green);
		printf("생 산 중");
	}
	else {

		SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), Red);
		printf("대 기 중"); 
	}

	SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), White);

	CurPos(19, 5);
	printf("%-16d", CapitalState); CurPos(37, 5);

	if (ResourceType == Residence) {

		SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), Green);
		printf("생 산 중");
	}
	else {

		SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), Red);
		printf("대 기 중"); CurPos(19, 3);
	}

	SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), White);

	CurPos(0, 23);
}

void SystemMessage(char CityName[], short MessageType) {

	CurPos(12, 8);
	for (short i = 0; i < 33; ++i)putchar(' ');

	CurPos(12, 8);

	switch (MessageType) {
	
	case BuildingPhase:

		printf("건물 건설을 진행해주세요.");
		break;

	case EnterProductionPhase:

		for (int i = 0; i < 5; ++i) {
			
			CurPos(12, 8);

			for (short i = 0; i < 33; ++i)putchar(' ');

			CurPos(12, 8);

			SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), Cyan);

			if (i % 2) printf("생산 단계에 진입합니다.");
			else printf("Please Wait...");

			Sleep(500);
		}

		SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), White);
		break;

	case ProductionPhase:

		printf("자원 생산을 진행해주세요.");
		break;

	case AlreadyOccupied:

		SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), Red);
		printf("이미 건물을 지어진 공간입니다.");
		SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), White);
		break;

	case NotingLeft:

		SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), Red);
		printf("남은 건물이 없습니다.");
		SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), White);
		break;

	case Confirm:

		SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), Green);
		printf("건설하시려면 한 번 더 눌러주세요.");
		SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), White);
		break;

	case Canceled:

		SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), Red);
		printf("취소되었습니다.");
		SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), White);
		break;
		
	default:

		SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), Red);
		printf("Error, Someting Went Wrong");
		SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), White);
		break;
	}

	CurPos(0, 23);
}

void UserPrint(short UserPosition) {

	SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), Cyan);

	for (short i = 0; i < 12; ++i) {

		CurPos(52 + i, 22);

		if (i == UserPosition) putchar('*');
		else putchar(' ');
	}

	SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), White);

	CurPos(0, 23);
}

short BuildingConfirm(short BuildingType) {

	char UserInput;
	char DummyString[11] = { 0 };

	SystemMessage(DummyString, -3);

	UserInput = _getch();

	if ((BuildingType == Power && UserInput == 'e') ||
		(BuildingType == Factory && UserInput == 't') ||
		(BuildingType == Residence && UserInput == 'm')) {

		return True;
	}

	return False;
}

void BuildingBuilder(short OccupyState[]) {

	for (short i = 0; i < 12; ++i) {

		if (!OccupyState[i]) continue;
		if (OccupyState[i] == Power) MakePower(i, PowerHeight);
		else if (OccupyState[i] == Factory) MakeFactory(i, FactoryHeight);
		else if (OccupyState[i] == Residence) MakeResidence(i, ResidenceHeight);
	}
}

void MakePower(short UserPosition, short Health) {

	SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), Yellow);

	for (short i = 20; i > 20 - Health; --i) {
	
		CurPos(52 + UserPosition, i);
		putchar('E');
	}

	SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), White);

	CurPos(0, 23);
}

void MakeFactory(short UserPosition, short Health) {

	SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), Red);

	for (short i = 20; i > 20 - Health; --i) {

		CurPos(52 + UserPosition, i);
		putchar('T');
	}

	SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), White);

	CurPos(0, 23);
}

void MakeResidence(short UserPosition, short Health) {

	SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), Green);

	for (short i = 20; i > 20 - Health; --i) {

		CurPos(52 + UserPosition, i);
		putchar('M');
	}

	SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), White);

	CurPos(0, 23);
}